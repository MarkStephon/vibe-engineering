FROM golang:1.24

WORKDIR /go/src/vibe-backend

# 安装 entr (文件监听工具，用于热重载)
RUN apt-get update && apt-get install -y entr && rm -rf /var/lib/apt/lists/*

# 复制 go mod 文件
COPY go.mod go.sum ./
RUN go mod download

# 复制源代码
COPY . .

# 暴露端口
EXPOSE 8080

# 使用 entr 监听 .go 文件变化，自动重新编译运行
CMD find . -name "*.go" -type f | entr -r go run ./cmd/server/main.go

