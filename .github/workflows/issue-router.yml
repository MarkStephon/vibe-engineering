name: Issue Router

on:
  issues:
    types: [opened, labeled]
  issue_comment:
    types: [created]

jobs:
  route:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
      - name: Route Issue to Agent
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const comment = context.payload.comment;
            const body = comment?.body || issue?.body || '';
            
            // è¯†åˆ«è§¦å‘å‘½ä»¤
            const triggers = {
              '/agent-ui': { label: 'agent:ui' },
              '/agent-be': { label: 'agent:backend' },
              '/agent-fe': { label: 'agent:frontend' },
            };
            
            let matched = null;
            for (const [trigger, config] of Object.entries(triggers)) {
              if (body.includes(trigger)) {
                matched = { trigger, ...config };
                break;
              }
            }
            
            if (matched) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: [matched.label, 'ğŸ¤– ai-processing']
              });
              
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ğŸ¤– **AI Agent å·²å¯åŠ¨**\n\n` +
                      `å‘½ä»¤: \`${matched.trigger}\`\n` +
                      `çŠ¶æ€: å¤„ç†ä¸­...\n\n` +
                      `è¯·åœ¨ [Actions](/${context.repo.owner}/${context.repo.repo}/actions) æ ‡ç­¾é¡µæŸ¥çœ‹å®æ—¶è¿›åº¦ã€‚`
              });
            }
