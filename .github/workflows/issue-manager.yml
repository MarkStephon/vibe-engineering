name: Issue Manager - Issue 欢迎消息与自动标签

on:
  issues:
    types: [opened]

jobs:
  welcome:
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: Auto-label and Welcome New Issues
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const body = issue.body || '';
            const title = issue.title || '';
            const text = (title + ' ' + body).toLowerCase();
            
            const labels = [];
            
            // 自动识别类型
            if (text.includes('ui') || text.includes('前端') || text.includes('界面')) {
              labels.push('frontend');
            }
            if (text.includes('api') || text.includes('后端') || text.includes('backend')) {
              labels.push('backend');
            }
            if (text.includes('bug') || text.includes('错误')) {
              labels.push('bug');
            }
            if (text.includes('feature') || text.includes('功能')) {
              labels.push('enhancement');
            }
            
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels
              });
            }
            
            // 欢迎消息
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: [
                "👋 欢迎！",
                "",
                labels.length > 0 ? `🏷️ 自动标签: ${labels.map(l => `\`${l}\``).join(', ')}` : "",
                "",
                "🤖 **Vibe Router 将自动分析此需求并触发相应的 AI Agent**",
                "",
                "---",
                "",
                "**手动触发命令（可选）:**",
                "",
                "| 命令 | 说明 | 适用场景 |",
                "|------|------|----------|",
                "| `/agent-simple` | 直接开发 | 小改动、bug修复 |",
                "| `/agent-medium` | 分析后开发 | 新功能、多文件修改 |",
                "| `/agent-complex` | 拆分子任务 | 大型功能、需要规划 |",
                "",
                "**专项 Agent:**",
                "",
                "| 命令 | 说明 |",
                "|------|------|",
                "| `/agent-ui` | 生成 UI 设计规格（PR 形式） |",
                "| `/agent-spec` | 生成完整技术规格并发布到评论区 |",
                "| `/agent-be <url>` | 生成后端代码 |",
                "| `/agent-fe <url>` | 生成前端代码 |",
                "",
                "> 💡 无需手动触发，Vibe Router 会自动判断复杂度并分配任务。",
                "> 📊 任务状态会自动更新，可通过标签查看进度。"
              ].join("\n")
            });

